---
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import { formatDate } from '../../utils/date';
import CTABox from '../../components/CTABox.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import HeroBlog from '../../components/HeroBlog.astro';
import SEO from '../../components/SEO.astro';
import dmarcImg from '../../assets/images/blog/email-verification.webp';

const title = "Email Verification & DMARC: Protect Your Business Email";
const description = "Essential guide to implementing DMARC, SPF, and DKIM for business email security. Learn how to protect your email from spoofing and phishing attacks.";
const date = "2024-03-12";
const author = "Huntertech Team";
const category = "Cybersecurity";
const keywords = ["DMARC", "email security", "SPF", "DKIM", "email authentication", "email spoofing", "phishing protection", "email verification"];

const structuredData = {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": title,
    "image": dmarcImg.src,
    "author": {
        "@type": "Organization",
        "name": "Huntertech",
        "url": "https://huntertech.ca"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Huntertech",
        "logo": {
            "@type": "ImageObject",
            "url": "https://huntertech.ca/logo.png"
        }
    },
    "datePublished": date,
    "dateModified": date,
    "description": description,
    "keywords": keywords.join(", "),
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://huntertech.ca/blog/email-verification-dmarc"
    },
    "articleSection": "Email Security",
    "inLanguage": "en-CA"
};
---

<Layout title={title}>
    <SEO 
        title={title}
        description={description}
        image={dmarcImg.src}
        type="article"
        keywords={keywords}
        location="Vancouver"
    />
    
    <Header />
    
    <main class="blog-post">
        <HeroBlog 
            title={title}
            subtitle={`By ${author} â€¢ ${formatDate(date)}`}
            backgroundImage={dmarcImg}
            backgroundImageAlt="Email Verification and DMARC Setup Guide"
        />

        <div class="container">
            <div class="post-content">
                <p>I've been seeing a common issue faced by many companies. They send emails through a bulk email provider like Mailchimp, Ticketmaster, Brevo, Hubspot, etc. and their emails are getting flagged as possible spam or as unverified.</p>

                <h2>Understanding the Problem</h2>
                <p>Let's break this down to show what's happening. When a company sends email using their Mailchimp Account, it should be legitimate, right? Let's check the mail header to understand what's going wrong.</p>

                <blockquote>
                    Authentication-Results: spf=pass (sender IP is 198.2.144.59) smtp.mailfrom=mail59.atl301.rsgsv.net; dkim=pass (signature was verified) header.d=mailchimpapp.net; dmarc=fail action=none header.from=deploydepot.ca; compauth=fail reason=001
                </blockquote>

                <p>Pulling out the important info:</p>
                <ul>
                    <li>SPF Passed</li>
                    <li>DKIM Passed</li>
                    <li>DMARC Failed</li>
                    <li>Fail reason = 001</li>
                </ul>

                <h2>What is DMARC, DKIM, and SPF?</h2>
                <p>DMARC (Domain-based Message Authentication, Reporting, and Conformance) builds upon SPF (Sender Policy Framework) and DKIM (DomainKeys Identified Mail). Its goal is to increase email security. Here's how it works:</p>

                <h3>Authentication Standards</h3>
                <ul>
                    <li><strong>SPF</strong>: Checks if the sender's IP address is authorized to send emails on behalf of a domain. It specifies which servers are allowed to send mail for a domain.</li>
                    <li><strong>DKIM</strong>: Adds a digital signature to outgoing emails. The recipient's server can verify this signature to ensure the email hasn't been tampered with.</li>
                </ul>

                <h3>DMARC Implementation</h3>
                <ul>
                    <li>DMARC allows domain owners to set policies for handling emails that fail authentication checks.</li>
                    <li>An organization can publish a DMARC policy that says, "If you send mail from my domain, it must pass SPF and DKIM checks."</li>
                    <li>DMARC creates a feedback loop between the sender and receiver. If an email fails authentication, the receiver can send a report back to the sender, detailing why it failed.</li>
                </ul>

                <h2>How to Fix the Issue</h2>
                <p>In the Mailchimp example, the CNAME record you create is actually pointing at their TXT record which holds the public key used to verify the DKIM signature applied by the Mailchimp mail server.</p>

                <p>A proper TXT record should be formatted like this:</p>
                <pre>[selector]._domainkey.[domain]</pre>

                <p>With a value of:</p>
                <pre>v=DKIM1; p=[insert public key here]</pre>

                <h3>Step 1: Find the Selector</h3>
                <p>In your email, you need to open the message details or header (in Outlook you can right-click -> View -> Message Details). Scroll to the DKIM-Signature section of the header and take note of these important items:</p>
                <ul>
                    <li>d= is the Domain (e.g., mailchimpapp.net)</li>
                    <li>s= is the Selector (e.g., k3)</li>
                    <li>v= is the version</li>
                    <li>a= is the algorithm used to apply the DKIM signature</li>
                </ul>

                <h3>Step 2: Create the DNS Records</h3>
                <p>Head over to www.mxtoolbox.com and use their Super Tool. Select the DKIM Lookup from the dropdown and enter the d value and s value separated by a colon (:) - example: mailchimpapp.net:k3</p>

                <p>This will show you the DKIM record for your email provider. When you create your CNAME record, this is what you are pointing to. This has the public key used to verify the DKIM signature.</p>

                <h2>Setting Up DMARC Records</h2>
                <p>The last piece of the puzzle is setting up your DMARC records. You should create a mailbox or distribution list to collect DMARC reports and set your DNS DMARC to reject or quarantine emails that don't pass DMARC. Or you can use a service like <a href="https://www.uriports.com" target="_blank">https://www.uriports.com</a> to collect the reports for you.</p>

                <p>Example DMARC TXT DNS record:</p>
                <pre>v=DMARC1; p=quarantine; adkim=s; aspf=s; rua=mailto:dmarcfailure@yourdomain.ca</pre>

                <p>What this means:</p>
                <ul>
                    <li><strong>v=DMARC1</strong>: Indicates this is a DMARC policy</li>
                    <li><strong>p=quarantine</strong>: Email servers should "quarantine" emails that fail DKIM and SPF</li>
                    <li><strong>adkim=s</strong>: DKIM checks are "strict"</li>
                    <li><strong>aspf=s</strong>: SPF checks are "strict"</li>
                    <li><strong>rua=mailto:xxxx</strong>: Sends DMARC reports to this email address</li>
                </ul>

                <CTABox 
                    title="Need Help with Email Authentication?"
                    description="Contact our team for expert assistance with email verification and DMARC setup for your business."
                    buttonText="Get Expert Help"
                    buttonLink="/contact"
                />
            </div>
        </div>
    </main>
    <Footer />
</Layout>

<style>
    .blog-post {
        background: var(--bg-color);
    }

    .post-content {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px 60px;
        line-height: 1.8;
    }

    .post-content h2 {
        color: var(--text-color);
        margin: 40px 0 20px;
        font-size: 1.8em;
    }

    .post-content h3 {
        color: var(--text-color);
        margin: 30px 0 15px;
        font-size: 1.4em;
    }

    .post-content p {
        margin-bottom: 20px;
    }

    .post-content ul, .post-content ol {
        margin-bottom: 20px;
        padding-left: 20px;
    }

    .post-content li {
        margin-bottom: 10px;
    }

    .post-content blockquote {
        background: var(--secondary-bg);
        padding: 1.5rem;
        border-left: 4px solid var(--button-color);
        margin: 1.5rem 0;
        font-family: monospace;
        overflow-x: auto;
    }

    .post-content pre {
        background: var(--secondary-bg);
        padding: 1rem;
        border-radius: var(--radius-md);
        overflow-x: auto;
        font-family: monospace;
        margin: 1rem 0;
    }

    @media (max-width: 768px) {
        .post-content {
            padding: 0 15px 40px;
        }
    }
</style> 