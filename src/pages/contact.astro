---
import { Image } from 'astro:assets';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import MapPin from '../components/icons/map-pin.astro';
import Phone from '../components/icons/phone.astro';
import Envelope from '../components/icons/envelope.astro';
import Clock from '../components/icons/clock.astro';
import contactBg from '../assets/images/contact-bg.webp';

const title = "Contact Huntertech | IT Services Calgary & Vancouver";
const description = "Get in touch with Huntertech for expert IT services and technology solutions in Calgary and Vancouver. We're here to help your business succeed.";
const keywords = [
    "contact Huntertech",
    "IT services Calgary",
    "IT services Vancouver",
    "technology solutions",
    "business IT support"
];

const organizationData = {
    "@context": "https://schema.org",
    "@type": "Organization",
    "@id": "https://huntertech.ca",
    "name": "Huntertech",
    "url": "https://huntertech.ca",
    "logo": {
        "@type": "ImageObject",
        "url": "https://huntertech.ca/images/huntertech-logo.png",
        "width": "600",
        "height": "60"
    },
    "sameAs": [
        "https://www.linkedin.com/company/hunter-tech",
        "https://www.facebook.com/huntertechca"
    ]
};

const calgaryContactData = {
    "@context": "https://schema.org",
    "@type": "ContactPoint",
    "@id": "https://huntertech.ca/calgary/#contact",
    "telephone": "825-415-6990",
    "contactType": "customer service",
    "areaServed": "CA-AB",
    "availableLanguage": "English",
    "contactOption": "TollFree"
};

const vancouverContactData = {
    "@context": "https://schema.org",
    "@type": "ContactPoint",
    "@id": "https://huntertech.ca/vancouver/#contact",
    "telephone": "778-819-7411",
    "contactType": "customer service",
    "areaServed": "CA-BC",
    "availableLanguage": "English",
    "contactOption": "TollFree"
};
---

<Layout 
    title={title} 
    description={description}
    canonicalURL="https://huntertech.ca/contact/"
    keywords={keywords}
    type="website"
    image={contactBg.src}
>
    <Fragment slot="head">
        <script type="application/ld+json" set:html={JSON.stringify(organizationData)} />
        <script type="application/ld+json" set:html={JSON.stringify(calgaryContactData)} />
        <script type="application/ld+json" set:html={JSON.stringify(vancouverContactData)} />
    </Fragment>
    <Header />
    <main class="contact-page">
        <section class="contact-section">
            <div class="container">
                <h1 class="page-title">Contact Huntertech</h1>
                <div class="contact-grid">
                    <div class="contact-info">
                        <h2>Get in Touch</h2>
                        <div class="info-item">
                            <MapPin color="var(--primary-color)" />
                            <div>
                                <h3>Service Areas</h3>
                                <p>Calgary, AB<br>Vancouver, BC</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <Phone color="var(--primary-color)" />
                            <div>
                                <h3>Calgary Phone</h3>
                                <p><a href="tel:+18254156990">(825) 415-6990</a></p>
                            </div>
                        </div>
                        <div class="info-item">
                            <Phone color="var(--primary-color)" />
                            <div>
                                <h3>Vancouver Phone</h3>
                                <p><a href="tel:+17788197411">(778) 819-7411</a></p>
                            </div>
                        </div>
                        <div class="info-item">
                            <Envelope color="var(--primary-color)" />
                            <div>
                                <h3>Email</h3>
                                <p><a href="mailto:info@huntertech.ca">info@huntertech.ca</a></p>
                            </div>
                        </div>
                        <div class="info-item">
                            <Clock color="var(--primary-color)" />
                            <div>
                                <h3>Hours</h3>
                                <p>Monday - Friday: 8:00 AM - 5:00 PM</p>
                            </div>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h2>Send us a Message</h2>
                        <form name="contact" method="POST" netlify-honeypot="bot-field" data-netlify="true" class="netlify-form">
                            <input type="hidden" name="form-name" value="contact" />
                            <input type="hidden" name="form_conversion" id="form_conversion" value="" />
                            <div class="form-field hidden">
                                <label>Don't fill this out if you're human: <input name="bot-field" /></label>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-field">
                                    <label for="firstName">First Name *</label>
                                    <input type="text" id="firstName" name="firstName" required />
                                </div>
                                <div class="form-field">
                                    <label for="lastName">Last Name *</label>
                                    <input type="text" id="lastName" name="lastName" required />
                                </div>
                            </div>
                            
                            <div class="form-field">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" required />
                            </div>
                            
                            <div class="form-field">
                                <label for="company">Company Name</label>
                                <input type="text" id="company" name="company" />
                            </div>
                            
                            <div class="form-field">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" />
                            </div>
                            
                            <div class="form-row">
                                <div class="form-field">
                                    <label for="location">Location</label>
                                    <select id="location" name="location">
                                        <option value="">Select Location</option>
                                        <option value="Calgary">Calgary</option>
                                        <option value="Vancouver">Vancouver</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-field">
                                    <label for="service">Service Interest</label>
                                    <select id="service" name="service">
                                        <option value="">Select Service</option>
                                        <option value="Managed IT Services">Managed IT Services</option>
                                        <option value="Cybersecurity">Cybersecurity</option>
                                        <option value="TaxCycle Support">TaxCycle Support</option>
                                        <option value="Revit Management">Revit Management</option>
                                        <option value="Cloud Solutions">Cloud Solutions</option>
                                        <option value="IT Consultation">IT Consultation</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-field">
                                <label for="message">Message *</label>
                                <textarea id="message" name="message" rows="5" placeholder="Tell us about your IT needs and how we can help..." required></textarea>
                            </div>
                            
                            <div class="form-field checkbox-field">
                                <input type="checkbox" id="newsletter" name="newsletter" value="yes" />
                                <label for="newsletter">I'd like to receive IT tips and insights via email</label>
                            </div>
                            
                            <button type="submit" class="submit-btn">Send Message</button>
                            
                            <p class="form-note">We'll respond within 24 hours. For urgent IT issues, please call us directly.</p>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <Footer />
</Layout>

<!-- Netlify Form Handler with HubSpot Integration -->
<script>
    // Form submission handler
    document.addEventListener('DOMContentLoaded', function() {
        // Capture form_conversion from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const formConversion = urlParams.get('form_conversion');
        const formConversionField = document.getElementById('form_conversion');
        
        if (formConversion && formConversionField) {
            formConversionField.value = formConversion;
        }
        
        const form = document.querySelector('.netlify-form');
        if (form) {
            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                // Submit to Netlify
                try {
                    const netlifyResponse = await fetch('/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(formData).toString()
                    });
                    
                    if (netlifyResponse.ok) {
                        // Submit to HubSpot
                        await submitToHubSpot(data);
                        
                        // Show success message
                        showSuccessMessage();
                        form.reset();
                    } else {
                        throw new Error('Form submission failed');
                    }
                } catch (error) {
                    console.error('Form submission error:', error);
                    showErrorMessage();
                }
            });
        }
    });
    
    // HubSpot integration
    async function submitToHubSpot(data) {
        const hubspotData = {
            fields: [
                { name: 'firstname', value: data.firstName },
                { name: 'lastname', value: data.lastName },
                { name: 'email', value: data.email },
                { name: 'company', value: data.company || '' },
                { name: 'phone', value: data.phone || '' },
                { name: 'city', value: data.location || '' },
                { name: 'service_interest', value: data.service || '' },
                { name: 'message', value: data.message },
                { name: 'newsletter_signup', value: data.newsletter || 'no' },
                { name: 'form_conversion', value: data.form_conversion || '' }
            ],
            context: {
                pageUri: window.location.href,
                pageName: document.title
            }
        };
        
        try {
            const response = await fetch('https://api.hsforms.com/submissions/v3/integration/submit/47750250/c4506331-7284-4ba7-91b6-48ef91992b78', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(hubspotData)
            });
            
            if (!response.ok) {
                console.warn('HubSpot submission failed, but Netlify succeeded');
            }
        } catch (error) {
            console.warn('HubSpot submission error:', error);
        }
    }
    
    function showSuccessMessage() {
        const form = document.querySelector('.netlify-form');
        const successMsg = document.createElement('div');
        successMsg.className = 'form-success';
        successMsg.innerHTML = `
            <h3>Thank you for your message!</h3>
            <p>We've received your inquiry and will respond within 24 hours. For urgent IT issues, please call us directly.</p>
        `;
        form.parentNode.insertBefore(successMsg, form);
        form.style.display = 'none';
        
        setTimeout(() => {
            successMsg.remove();
            form.style.display = 'block';
        }, 10000);
    }
    
    function showErrorMessage() {
        const form = document.querySelector('.netlify-form');
        const errorMsg = document.createElement('div');
        errorMsg.className = 'form-error';
        errorMsg.innerHTML = `
            <p>Sorry, there was an error sending your message. Please try again or contact us directly at <a href="mailto:info@huntertech.ca">info@huntertech.ca</a></p>
        `;
        form.parentNode.insertBefore(errorMsg, form);
        
        setTimeout(() => {
            errorMsg.remove();
        }, 8000);
    }
</script>

<style>
    .contact-page {
        padding-top: 80px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    .page-title {
        text-align: center;
        color: var(--primary-color);
        margin-bottom: 3rem;
        font-size: 2.5rem;
    }

    .contact-section {
        padding: 4rem 1rem;
    }

    .contact-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 4rem;
    }

    .contact-info h2,
    .contact-form h2 {
        color: var(--primary-color);
        margin-bottom: 2rem;
        font-size: 1.8rem;
    }

    .info-item {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .info-item svg {
        width: 1.5rem;
        height: 1.5rem;
        color: var(--primary-color);
        margin-right: 1rem;
    }

    .info-item h3 {
        color: var(--text-color);
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
    }

    .info-item p {
        color: #666;
        line-height: 1.6;
    }

    .contact-form {
        background: var(--white);
        padding: 2rem;
        border-radius: var(--radius-md);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .contact-form h2 {
        color: var(--primary-color);
        margin-bottom: 2rem;
        font-size: 1.8rem;
    }

    /* HubSpot Form Styling */
    .hs-form-frame {
        width: 100%;
    }

    /* Remove old form styles */
    .form-group,
    .form-group label,
    .form-group input,
    .form-group textarea,
    .submit-button {
        display: none;
    }

    /* Netlify Form Styles */
    .netlify-form {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .form-field {
        display: flex;
        flex-direction: column;
    }

    .form-field.hidden {
        display: none;
    }

    .form-field label {
        color: var(--text-color);
        font-weight: 500;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-field input,
    .form-field select,
    .form-field textarea {
        padding: 0.75rem;
        border: 2px solid #e1e1e1;
        border-radius: var(--radius-sm);
        font-size: 1rem;
        transition: border-color 0.3s ease;
        font-family: inherit;
    }

    .form-field input:focus,
    .form-field select:focus,
    .form-field textarea:focus {
        outline: none;
        border-color: var(--button-color);
        box-shadow: 0 0 0 3px rgba(0, 172, 172, 0.1);
    }

    .form-field textarea {
        resize: vertical;
        min-height: 120px;
    }

    .checkbox-field {
        flex-direction: row !important;
        align-items: center;
        gap: 0.75rem;
    }

    .checkbox-field input[type="checkbox"] {
        width: auto;
        margin: 0;
    }

    .checkbox-field label {
        margin: 0;
        font-size: 0.9rem;
        color: #666;
    }

    .submit-btn {
        background: var(--button-color);
        color: var(--white);
        padding: 1rem 2rem;
        border: none;
        border-radius: var(--radius-md);
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        align-self: flex-start;
    }

    .submit-btn:hover {
        background: var(--button-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 172, 172, 0.3);
    }

    .submit-btn:active {
        transform: translateY(0);
    }

    .form-note {
        font-size: 0.85rem;
        color: #666;
        margin: 0;
        font-style: italic;
    }

    /* Success and Error Messages */
    .form-success,
    .form-error {
        padding: 1.5rem;
        border-radius: var(--radius-md);
        margin-bottom: 2rem;
    }

    .form-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }

    .form-success h3 {
        margin: 0 0 0.5rem 0;
        color: #155724;
    }

    .form-success p {
        margin: 0;
    }

    .form-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }

    .form-error p {
        margin: 0;
    }

    .form-error a {
        color: #721c24;
        font-weight: 600;
    }

    @media (max-width: 768px) {
        .contact-grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .submit-btn {
            width: 100%;
            text-align: center;
        }
    }
</style> 